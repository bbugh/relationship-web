<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      color: #1e1e1e;
    }

    #controls,
    #navigation,
    #totalConnections,
    #guideText {
      margin: 20px;
      text-align: center;
    }

    #container {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 20px;
      padding: 20px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      background-color: #f9f9f9;
      margin: 20px auto;
    }

    canvas {
      width: 150px;
      height: 150px;
      border: 1px dashed #ccc;
      border-radius: 10px;
      background-color: #262A2B;
    }

    #guideText {
      background-color: #eaeaea;
      border: 2px solid #4E79A7;
      border-radius: 10px;
      padding: 20px;
      max-width: 75ch;
      width: 100%;
      margin: 20px auto;
      font-size: 18px;
      line-height: 1.6;
      color: #1e1e1e;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s, color 0.3s;
      text-align: left;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: #1e1e1e;
        color: #dfdcd7;
      }

      #container {
        border: 1px solid #4B4943;
        background-color: #262A2B;
      }

      #guideText {
        background-color: #202324;
        border: 2px solid #4E79A7;
        color: #f0f0f0;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        font-size: 16px;
      }
    }

    #container,
    #guideText,
    #totalConnections {
      /* make sure this is the same timing as applyTransition */
      transition: opacity 0.1s ease;
    }

    .hidden {
      opacity: 0;
    }
  </style>
</head>

<body>
  <div id="controls">
    <label for="peopleCount">Number of People: </label>
    <select id="peopleCount">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>

    <div id="navigation" style="text-align: center; margin: 20px;">
      <button id="prevButton" style="margin-right: 10px;">Previous</button>
      <button id="nextButton">Next</button>
    </div>

  </div>

  <div id="totalConnections" style="text-align: center; margin: 10px;"></div>

  <div id="guideText"></div>


  <div id="container"></div>

  <script>
    const container = document.getElementById('container');
    const peopleCountSelect = document.getElementById('peopleCount');
    const groupSize = 150;
    const radius = 40;

    const guideTexts = {
      1: "When you are alone, every decision is your own. You set the pace, choose the direction, and only answer to yourself. It's an opportunity to learn self-reliance and build a strong foundation for future relationships.",
      2: "When two people connect, three relationships form: the relationship each person has with themselves, and the one they share together. Many couples focus on \"us\" but often overlook the importance of maintaining healthy connections with \"self\".",
      3: "In a group of three, dynamics can shift quickly. There are seven relationships at play. Trios often face challenges with balance, whether it's feeling left out or managing how each pair interacts within the group. This can be especially true in relationships with natural power imbalances, like parents or executives.",
      4: "With four people, fifteen relationships emerge. This is where the complexity of small groups shows up. Teams of four can accomplish a lot if they find a rhythm, but they also need to navigate differing priorities and perspectives. Leadership may begin to appear, but still be fluid.",
      5: "A group of five introduces thirty-one relationships. At this size, roles often start to form naturally: leaders, listeners, organizers. It's helpful to recognize and adapt to these roles while keeping the group's goals in mind.",
      6: "Six people create sixty-three relationships. It's a small community where different personalities and ideas mix. This is often when group culture starts to take shape, and being intentional about that culture can make a big difference.",
      7: "Seven people bring 127 relationships into play. At this level, subgroups and alliances can form. It's a good time to focus on inclusivity and making sure every voice is heard.",
      8: "With eight people, there are 255 connections. This is like a small organization where communication matters more than ever. Keeping the group aligned on goals and values helps prevent misunderstandings.",
      9: "Nine people create 511 relationships. Maintaining clarity and consistency becomes a challenge. It helps to establish clear norms and practices that keep the group functioning well even as individual connections ebb and flow.",
      10: "Ten people generate 1023 relationships. At this scale, it's easy for individuals to feel lost or for messages to get muddled. Strong leadership and open communication channels help everyone stay connected and engaged."
    };

    const colors = [
      'hsl(211, 36%, 48%)', // Blue
      'hsl(30, 88%, 56%)', // Orange
      'hsl(113, 34%, 47%)', // Green
      'hsl(45, 84%, 67%)', // Yellow
      'hsl(177, 35%, 44%)', // Cyan
      'hsl(359, 70%, 61%)', // Red
      'hsl(317, 26%, 58%)', // Purple
      'hsl(22, 24%, 49%)', // Pink
      'hsl(16, 9%, 60%)', // Gray
      'hsl(354, 100%, 81%)'  // Brown
    ]

    peopleCountSelect.addEventListener('change', () => {
      drawVisualization(parseInt(peopleCountSelect.value));
    });

    function drawVisualization(count) {
      container.innerHTML = '';
      let totalGroups = 0;
      let groupIndex = 1;

      for (let size = 1; size <= count; size++) {
        const combinations = getCombinations(Array.from({ length: count }, (_, i) => i), size);
        totalGroups += combinations.length;
        combinations.forEach(comb => {
          drawGroup(comb, groupIndex);
          groupIndex++;
        });
      }

      document.getElementById('totalConnections').textContent = `Total Number of Groups: ${totalGroups}`;
      document.getElementById('guideText').textContent = guideTexts[count] || "No guide available for this number of people.";
    }

    function drawGroup(indices, groupIndex) {
      const canvas = document.createElement('canvas');
      canvas.width = groupSize;
      canvas.height = groupSize;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, groupSize, groupSize);

      const centerX = groupSize / 2;
      const centerY = groupSize / 2;
      const points = [];

      if (indices.length === 1) {
        drawCircle(ctx, centerX, centerY, indices[0] + 1, colors[indices[0] % colors.length]);
      } else {
        indices.reverse().forEach((i, idx) => {
          const angle = indices.length === 2
            ? idx * Math.PI
            : (idx / indices.length) * 2 * Math.PI - Math.PI / 2;
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);
          points.push({ x, y, color: colors[i % colors.length] });
        });

        for (let i = 0; i < points.length; i++) {
          for (let j = i + 1; j < points.length; j++) {
            drawLine(ctx, points[i].x, points[i].y, points[j].x, points[j].y, points[i].color, points[j].color);
          }
        }

        indices.forEach((i, idx) => {
          drawCircle(ctx, points[idx].x, points[idx].y, i + 1, colors[i % colors.length]);
        });
      }

      ctx.fillStyle = 'hsl(0, 0%, 49.8%)';
      ctx.font = '12px Arial';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'bottom';
      ctx.fillText(groupIndex, groupSize - 8, groupSize - 8);

      container.appendChild(canvas);
    }

    function drawCircle(ctx, x, y, label, color) {
      ctx.beginPath();
      ctx.arc(x, y, 15, 0, 2 * Math.PI);
      ctx.fillStyle = color;
      ctx.fill();
      ctx.fillStyle = 'white';
      ctx.font = 'bold 14px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(label, x, y);
      ctx.closePath();
    }

    function drawLine(ctx, x1, y1, x2, y2, colorA, colorB) {
      const gradient = ctx.createLinearGradient(x1, y1, x2, y2);
      gradient.addColorStop(0, colorA);
      gradient.addColorStop(1, colorB);
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = gradient;
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.closePath();
    }

    function getCombinations(arr, size) {
      const result = [];
      const f = (prefix = [], arr) => {
        if (prefix.length === size) {
          result.push(prefix);
          return;
        }
        for (let i = 0; i < arr.length; i++) {
          f([...prefix, arr[i]], arr.slice(i + 1));
        }
      };
      f([], arr);
      return result;
    }

    drawVisualization(parseInt(peopleCountSelect.value));

    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');

    function applyTransition() {
      const container = document.getElementById('container');
      const guideText = document.getElementById('guideText');
      const totalConnections = document.getElementById('totalConnections');

      // Add the 'hidden' class to trigger the fade-out
      container.classList.add('hidden');
      guideText.classList.add('hidden');
      totalConnections.classList.add('hidden');

      setTimeout(() => {
        drawVisualization(parseInt(peopleCountSelect.value));
        container.classList.remove('hidden');
        guideText.classList.remove('hidden');
        totalConnections.classList.remove('hidden');
      }, 100);
    }

    prevButton.addEventListener('click', () => {
      const currentCount = parseInt(peopleCountSelect.value);
      if (currentCount > 1) {
        peopleCountSelect.value = currentCount - 1;
        applyTransition();
      }
    });

    nextButton.addEventListener('click', () => {
      const currentCount = parseInt(peopleCountSelect.value);
      if (currentCount < 10) {
        peopleCountSelect.value = currentCount + 1;
        applyTransition();
      }
    });
  </script>
</body>

</html>
